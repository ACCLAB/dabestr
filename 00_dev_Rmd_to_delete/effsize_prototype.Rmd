---
title: "effsize prototype"
author: "Joses Ho"
date: "2/7/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraries

```{r load.libraries}
library(dplyr)
library(dabestr)
# Packages <- c("dplyr", "effsize"#, "boot", "dabestr"
#               )
# 
# lapply(Packages, library, character.only = TRUE)
```

## Create Dummy Data

```{r create.dummy.data}
set.seed(54321)

N = 40
c1 <- rnorm(N, mean = 100, sd = 25)
c2 <- rnorm(N, mean = 100, sd = 50)
g1 <- rnorm(N, mean = 120, sd = 25)
g2 <- rnorm(N, mean = 80, sd = 50)
g3 <- rnorm(N, mean = 100, sd = 12)
g4 <- rnorm(N, mean = 100, sd = 50)
gender <- c(rep('Male', N/2), rep('Female', N/2))
id <- 1: N


wide.data <- 
  tibble::tibble(
    Control1 = c1, Control2 = c2,
    Group1 = g1, Group2 = g2, Group3 = g3, Group4 = g4,
    Gender = gender, ID = id)


tidy.data   <- wide.data %>% tidyr::gather(key = Group, value = Measurement, -ID, -Gender)

```



```{r test.out.named.ylabel.list}

effect.size.ylabeller <- list("mean difference", "median difference", "Cohen's d", "Hedges' g", "Cliff's delta")

names(effect.size.ylabeller) <- c("mean_diff", "median_diff", "cohens_d", "hedges_g", "cliffs_delta")
```


```{r sketch1}


# 
# db <- dabest(tidy.data, Group, Measurement, func = mean,
#               # idx = c("Control1", "Group1"),
#              
#               idx = list(c("Control1", "Group1"),
#                          c("Control2", "Group2")),
#               id.col =  ID,
#               paired = TRUE)
# 
# plot(db, color.column = Gender)

# unpaired_mean_diff <- dabest_proto(iris, Species, Petal.Width,
#                              idx = c("setosa", "versicolor"),
#                              paired = FALSE)
# 
# dbp %>% effect_size(ci = 95, reps = 5000)

unpaired_mean_diff <- dabest(iris, Species, Petal.Width,
                            idx = c("setosa", "versicolor"),
                            paired = FALSE)

dbp1 <- dabestr::dabest(tidy.data, Group, Measurement,
                    idx = list(c("Control1", "Group1"),
                               c("Control2", "Group2")),
                    # idx = c("Group1", "Control1"),
                    # id.col =  ID,
                    paired = FALSE)
res <- mean_diff(dbp1)


cohens_d(dbp1) %>% plot(color.column = Gender)

hedges_g(dbp1) %>% plot(color.column = Gender)

```



```{r sketch2}


dbp <- dabestr::dabest_proto(tidy.data, Group, Measurement,
                    idx = list(c("Control1", "Group1"), c("Control2", "Group2", "Group3")),
                    paired = FALSE)

db <- dabest(tidy.data, Group, Measurement, func = mean,
              idx = list(c("Control1", "Group1"), c("Control2", "Group2", "Group3")),
              paired = FALSE)

# unpaired_mean_diff <- dabest_proto(iris, Species, Petal.Width,
#                              idx = c("setosa", "versicolor"),
#                              paired = FALSE)
# 
# dbp %>% effect_size(ci = 95, reps = 5000)

aa <- hedges_g(dbp)

plot(aa)
```


## Scale Gardner-Altman contrast axes

```{r}
cohens_std <- function() {
  
}

hedges_correction_factor <- function() {
  
}

```




## Check effsize

```{r check.es}
cohens.d(c1, g2, paired = TRUE)

hedges.g(c1, g2, paired = TRUE)

cliffs.delta(c1, g2)

mean.diff(c1, g2)
```

## Try bootstrap!

```{r try.bootstrap}
# library(dqrng)
# dqRNGkind("pcg64")

#### Main API ####
dabest(tidy.data, Group, Measurement, 
       idx = c("Control1", "Group2"), 
       # paired = TRUE, id.column = ID,
       func = mean)


#### Current Guts ####
set.seed(12345)
unpaired_result1 <- simpleboot::two.boot(g2, c1, FUN = mean, R = 5000)
boot::boot.ci(unpaired_result1, type=c("percent", "bca"))
set.seed(NULL)


#### Prototype Guts ####
input_list <- data.frame(control=c1, test=g2)
set.seed(12345)


ppp <- boot::boot(statistic = es.boot, R = 5000, 
                  effsize = cliffs.delta, 
                  data = input_list,
                  paired = FALSE)

boot::boot.ci(ppp, type=c("percent", "bca"))
set.seed(NULL)





set.seed(12345)
paired_result <- simpleboot::pairs_boot(c1, g2, median.diff, R = 5000, paired=TRUE)
boot::boot.ci(paired_result, type=c("percent", "bca"))
set.seed(NULL)

```

```{r create my own boot object}
# # too damn complicated...

# my.boot.object <- list()
# 
# my.boot.object$t0 <- unpaired_result$t0
# my.boot.object$t <- unpaired_result$t
# my.boot.object$R <- unpaired_result$R
# my.boot.object$sim <- "ordinary"
# my.boot.object$stype <- "i"
# my.boot.object$statistic <- es.boot
# 
# 
# 
# class(my.boot.object) <- c("boot", "dabest.boot", "list")
# 
# 
# boot::boot.ci(my.boot.object, type=c("percent", "bca"))

```


