---
title: "effsize prototype"
author: "Joses Ho"
date: "2/7/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraries

```{r load.libraries}
library(dplyr)
library(dabestr)
# Packages <- c("dplyr", "effsize"#, "boot", "dabestr"
#               )
# 
# lapply(Packages, library, character.only = TRUE)
```

## Create Dummy Data

```{r create.dummy.data}
set.seed(54321)

N = 40
c1 <- rnorm(N, mean = 100, sd = 25)
c2 <- rnorm(N, mean = 100, sd = 50)
g1 <- rnorm(N, mean = 120, sd = 25)
g2 <- rnorm(N, mean = 80, sd = 50)
g3 <- rnorm(N, mean = 100, sd = 12)
g4 <- rnorm(N, mean = 100, sd = 50)
gender <- c(rep('Male', N/2), rep('Female', N/2))
id <- 1: N


wide.data <- 
  tibble::tibble(
    Control1 = c1, Control2 = c2,
    Group1 = g1, Group2 = g2, Group3 = g3, Group4 = g4,
    Gender = gender, ID = id)


tidy.data   <- wide.data %>% tidyr::gather(key = Group, value = Measurement, -ID, -Gender)

tidy.data$Group <- as.factor(tidy.data$Group)

```


```{r get.data}
# library(coin)
library(PairedData)
data(anscombe2)

dat <- tidy.data %>% dplyr::filter(Group == "Control1" | Group == "Group1")

tidy.anscombe2 <- anscombe2 %>% tidyr::gather(key = Group, value = Measurement, -Subject)

group1.tidy.anscombe2 <- tidy.anscombe2 %>% dplyr::filter(Group == "X1" | Group == "Y1")
```



```{r t.test.comparison}
#### anscombe2 ####
# R's built-in t-tests
t.test(anscombe2$X1, anscombe2$Y1, paired = TRUE)
wilcox.test(anscombe2$X1, anscombe2$Y1, paired = TRUE, alternative = 'two.sided')


# Using `coin`
coin::wilcoxsign_test(Y1 ~ X1, 
                      data = anscombe2,
                      distribution = "exact",
                      alternative = "two.sided")


#### custom data ####

coin::independence_test(data = dat,
                        Measurement ~ Group,
                        distribution = "asymptotic")

coin::independence_test(data = dat,
                        Measurement ~ Group,
                        distribution = "approximate")
```



```{r sketch1}


dbp1 <- dabest(tidy.data, Group, Measurement,
                    idx = list(c("Control1", "Group1"),
                               c("Control2", "Group2")),
                    # idx = c("Group1", "Control1"),
                    # id.col =  ID,
                    paired = FALSE)

res <- mean_diff(dbp1)


cohens_d(dbp1) %>% plot(color.column = Gender, show.legend = FALSE)

my_plot <- hedges_g(dbp1) %>% plot(color.column = Gender)

```



```{r sketch2}


dbp <- dabestr::dabest_proto(tidy.data, Group, Measurement,
                    idx = list(c("Control1", "Group1"), c("Control2", "Group2", "Group3")),
                    paired = FALSE)

db <- dabest(tidy.data, Group, Measurement, func = mean,
              idx = list(c("Control1", "Group1"), c("Control2", "Group2", "Group3")),
              paired = FALSE)

# unpaired_mean_diff <- dabest_proto(iris, Species, Petal.Width,
#                              idx = c("setosa", "versicolor"),
#                              paired = FALSE)
# 
# dbp %>% effect_size(ci = 95, reps = 5000)

aa <- hedges_g(dbp)

plot(aa)
```


